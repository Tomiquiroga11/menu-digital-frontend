<div class="manage-container">
    
  <header class="manage-header">
      <div class="header-text">
          <h1>Mis Productos</h1>
          <p>Gestiona tu cat√°logo, precios y promociones</p>
      </div>
      <div class="header-actions">
          <button (click)="mostrarConfigHH = !mostrarConfigHH" class="btn-config-hh" [class.active]="mostrarConfigHH">
              <span>üïê</span> Configurar Happy Hour
          </button>
          <a routerLink="/admin/productos/nuevo" class="btn-new">
              <span>+</span> Nuevo Producto
          </a>
      </div>
  </header>

  <div *ngIf="mostrarConfigHH" class="hh-config-panel">
      <div class="panel-header">
          <div class="panel-title">
              <h3>üî• Configuraci√≥n Happy Hour</h3>
              <span class="badge-hh">50% OFF Autom√°tico</span>
          </div>
          <button (click)="mostrarConfigHH = false" class="close-panel" title="Cerrar">‚úï</button>
      </div>
      
      <p class="panel-desc">Define el rango horario en el que tus productos marcados con "Happy Hour" tendr√°n descuento.</p>
      
      <div class="hh-inputs-container">
          <div class="time-box">
              <label>Inicio</label>
              <div class="input-wrapper">
                  <input type="number" [(ngModel)]="hhInicio" min="0" max="23">
                  <span class="suffix">:00 hs</span>
              </div>
          </div>
          
          <div class="arrow">‚ûù</div>

          <div class="time-box">
              <label>Fin</label>
              <div class="input-wrapper">
                  <input type="number" [(ngModel)]="hhFin" min="0" max="23">
                  <span class="suffix">:00 hs</span>
              </div>
          </div>

          <button (click)="guardarHappyHour()" class="btn-save-hh">Guardar Horario</button>
      </div>
  </div>

  <div class="table-card">
      
      <table *ngIf="!cargando && productos.length > 0">
          <thead>
              <tr>
                  <th width="80">Imagen</th>
                  <th>Producto</th>
                  <th>Precio</th>
                  <th>Descuento Fijo</th>
                  <th>Happy Hour</th>
                  <th class="text-right">Acciones</th>
              </tr>
          </thead>
          <tbody>
              <tr *ngFor="let prod of productos">
                  <td class="img-col">
                      <div class="img-wrapper">
                          <img [src]="prod.imagenUrl || 'assets/placeholder-food.jpg'" 
                               alt="{{prod.nombre}}"
                               onerror="this.src='https://placehold.co/100?text=Sin+Foto'">
                      </div>
                  </td>

                  <td class="info-col">
                      <div class="prod-name-wrapper">
                          <span class="prod-name">{{ prod.nombre }}</span>
                          <span *ngIf="prod.estaDestacado" class="badge-destacado" title="Producto Destacado">‚≠ê Top</span>
                      </div>
                      <span class="prod-desc">{{ prod.descripcion }}</span>
                  </td>

                  <td class="price-col">
                    <span class="currency">$</span>
                    {{ prod.precioOriginal ? prod.precioOriginal : prod.precio }}
                </td>
                  
                  <td>
                      <div class="discount-control">
                          <label class="switch">
                              <input type="checkbox" 
                                     [checked]="prod.tieneDescuento" 
                                     (change)="toggleDescuento(prod, $event)">
                              <span class="slider round"></span>
                          </label>
                          
                          <div class="discount-input" [class.active-input]="prod.tieneDescuento">
                              <input type="number" 
                                     [value]="prod.porcentajeDescuento" 
                                     (change)="updatePorcentaje(prod, $any($event.target).value)"
                                     min="0" max="100"
                                     placeholder="0">
                              <span>%</span>
                          </div>
                      </div>
                  </td>

                  <td>
                      <div class="hh-control">
                          <label class="switch hh-switch">
                              <input type="checkbox" 
                                     [checked]="prod.tieneHappyHour" 
                                     (change)="toggleHappyHour(prod, $event)">
                              <span class="slider round"></span>
                          </label>
                          <span class="status-text" [class.active]="prod.tieneHappyHour">
                              {{ prod.tieneHappyHour ? 'Activo' : 'Inactivo' }}
                          </span>
                      </div>
                  </td>

                  <td class="actions-col">
                      <a [routerLink]="['/admin/productos/editar', prod.id]" class="btn-icon edit" title="Editar">
                          ‚úèÔ∏è
                      </a>
                      <button (click)="onDelete(prod.id)" class="btn-icon delete" title="Eliminar">
                          üóëÔ∏è
                      </button>
                  </td>
              </tr>
          </tbody>
      </table>

      <div *ngIf="!cargando && productos.length === 0" class="empty-state">
          <div class="empty-img">üçî</div>
          <h3>¬°Tu men√∫ est√° vac√≠o!</h3>
          <p>Comienza agregando tus platos estrella para que tus clientes puedan verlos.</p>
          <a routerLink="/admin/productos/nuevo" class="btn-new large">Agregar mi primer producto</a>
      </div>
      
      <div *ngIf="cargando" class="loading-state">
          <div class="spinner"></div>
          <p>Cargando tus productos...</p>
      </div>
  </div>
</div>